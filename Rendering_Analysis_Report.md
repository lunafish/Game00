# Rendering System Technical Analysis Report (Detailed)

본 보고서는 `Game00` 프로젝트의 커스텀 렌더링 파이프라인 아키텍처와 각 구현 기술의 상세 원리를 분석합니다.

---

## 1. LNSurfaceGBuffer: 데이터 최적화 및 인코딩
표면의 물리적 속성을 효율적으로 저장하기 위해 MRT(Multiple Render Targets)와 고급 인코딩 기술을 사용합니다.

### 1.1 Octahedron Normal Encoding (법선 인코딩)
*   **원리:** 3차원 법선 벡터(x, y, z)를 2차원 평면(u, v)으로 투영하는 기술입니다. 단순히 (x, y)만 저장하는 방식보다 정밀도가 높고, 구체 전체를 8면체로 펼쳐 2차원에 매핑하는 `OctWrap` 함수를 사용합니다.
*   **이점:** GBuffer1의 RG 채널(각 8~16비트)만으로도 정밀한 법선을 재구성할 수 있어, 남는 B 채널에 **Linear Depth**를 함께 저장하는 최적화가 가능해집니다.

### 1.2 MRT 채널 레이아웃 및 패킹 (Packing)
데이터 대역폭을 줄이기 위해 여러 속성을 하나의 채널에 압축하여 저장합니다.
*   **GBuffer2 (Extra1):** R(마스크), G(금속성), B(매끄러움)를 각각 할당하여 PBR의 기본 속성을 관리합니다.
*   **GBuffer3 (Extra2):** 
    *   **Shadow:** 그림자 강도 기록.
    *   **Subsurface/Anisotropic:** 두 속성을 특정 범위로 정규화하여 하나의 G 채널에 패킹.
    *   **Intensity/Thickness:** SSS 연산에 필요한 강도와 두께 계수를 B 채널에 패킹하여 렌더 타겟 수를 최소화.

---

## 2. LNSurfaceFeature: 렌더 파이프라인 제어
URP의 최신 기능을 활용하여 멀티 패스 렌더링을 유연하게 제어합니다.

### 2.1 Resolution Scaling (해상도 스케일링)
*   조명 및 화면 공간 효과(SSGI, SSR 등)는 연산 부하가 매우 큽니다. `resolutionScale` 옵션(Full, Half, Quarter)을 통해 조명 계산 커널의 해상도를 조절하여 저사양 기기에서도 성능을 확보할 수 있도록 구현되었습니다.

### 2.2 Stylized Shadow Tint (스타일리시 그림자 톤)
*   **Complementary Mode:** 현재 조명 색상의 **보색**을 자동으로 계산하여 그림자 톤으로 설정합니다. 이는 예술적이고 생동감 있는 그림자 표현을 가능하게 합니다.
*   **Custom Mode:** 사용자가 지정한 고정 색상을 그림자에 입힙니다.

### 2.3 Back-to-Front 정렬의 기술적 필연성
*   일반적인 `Front-to-Back` 정렬은 Overdraw를 방지하지만, '현재 픽셀의 뒤에 무엇이 있는지' 알 수 없습니다.
*   **SSS 구현:** SSS는 빛이 물체 내부를 통과해 나오는 효과이므로, **뒷면의 깊이값(Back Depth)**이 필수입니다. `BackToFront` 정렬을 통해 뒷면 데이터가 먼저 GBuffer에 기록되도록 보장함으로써, 앞면 렌더링 시점에 뒷면과의 거리(Thickness)를 즉시 계산할 수 있는 구조를 완성했습니다.

---

## 3. LNSurfaceLighting: 하이이브리드 컴퓨팅
컴퓨트 셰이더 기반의 조명 엔진으로, 물리 기반 렌더링(PBR)과 화면 공간 효과를 통합합니다.

### 3.1 Disney BRDF 조명 모델
단순한 램버트(Lambert) 모델을 넘어 실감 나는 재질을 표현합니다.
*   **Diffuse:** `Diffuse Wrap` 파라미터를 통해 그림자의 경계선을 부드럽게 조절(Stylized Look).
*   **Specular:** 물체의 금속성과 매끄러움에 따른 정교한 반사광 계산.
*   **SSS (Subsurface Scattering):** 앞면/뒷면 깊이 차이를 이용한 지수 감쇠(Exponential Decay) 모델 적용.

### 3.2 Screen Space Effects (화면 공간 효과)
*   **SSGI (Global Illumination):** 8개의 레이(Ray)를 샘플링하여 주변 물체의 색상이 반사되어 묻어나는 간접광을 시뮬레이션합니다.
*   **SSR (Reflection):** 화면의 픽셀 데이터를 역추적(Ray-marching)하여 실시간 반사상을 생성합니다. `ssrMaxSteps(64)`와 `ssrThickness` 조절을 통해 반사의 정확도와 성능 사이의 균형을 맞춥니다.
*   **SSCS (Contact Shadows):** 아주 가까운 거리에서의 미세한 그림자를 추가하여 물체가 바닥에 떠 있는 느낌을 제거합니다.

---

## 4. 최종 결론 및 권장 최적화
현재 시스템은 고품질 비주얼을 위해 GPU 리소스를 적극적으로 활용하고 있습니다.
*   **최적화 팁:** 성능 저하 발생 시 `LNSurfaceFeature` 설정에서 `Resolution Scale`을 `Half`로 낮추고, `SSGI Sample Count`를 조정하는 것만으로도 큰 프레임 확보가 가능합니다.
*   **정렬 방식:** `BackToFront` 정렬에 따른 Overdraw 부하를 줄이기 위해, SSS가 불필요한 레이어는 별도의 패스로 분리하여 `CommonOpaque`로 렌더링하는 이원화 전략을 검토해 볼 수 있습니다.

---
*Generated by Gemini CLI Analysis Tool - 2026-02-20*
